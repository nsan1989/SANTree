<!--Bootstrap-->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
  integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous" />
{% load crispy_forms_tags %}
{% load static %} {% block start %}

<style>
  .task-form {
    font-family: 'Poppins', sans-serif;
  }
</style>

<div class="container-fluid d-flex flex-column justify-content-center align-items-center h-100">
  {% if messages %}
        {% for message in messages %}
        <div class="service-generate-alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
    {% endif %}
    {% if errors %}
        <div class="service-generate-error-alert alert-danger">
        {{ errors }}
        </div>
    {% endif %}
  <span style="width: auto;">
    <div class="mb-3">
      <a href="{% url 'srm:staff_dashboard' %}" class="d-flex align-items-center text-warning"
        style="text-decoration: none">
        <i class="fa-solid fa-arrow-left"></i>
        &nbsp;back
      </a>
    </div>
  </span>
  <div class="row w-100 d-flex justify-content-center">
    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 card shadow-lg p-3">
      <form id="generateServiceForm" class="task-form" method="post" enctype="multipart/form-data">
        {% csrf_token %} {{ form|crispy }}
        <div class="d-grid mt-4">
          <button type="submit" class="btn btn-primary btn-lg">Submit</button>
        </div>
      </form>
    </div>
  </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function () {
    $("#id_department").change(function () {
      const departmentId = $(this).val();

      // Load task types
      $.ajax({
        url: "{% url 'tms:ajax_load_tasks_types' %}",
        data: { department: departmentId },
        success: function (data) {
          const taskSelect = $("#id_tasks_types");
          taskSelect.empty();
          taskSelect.append('<option value="">Select Task Type</option>');
          data.forEach((item) =>
            taskSelect.append(
              `<option value="${item.id}">${item.name}</option>`
            )
          );
        },
      });

      // Load staff
      $.ajax({
        url: "{% url 'tms:ajax_load_staff' %}",
        data: { department: departmentId },
        success: function (data) {
          const staffSelect = $("#id_assigned_to");
          staffSelect.empty();
          staffSelect.append('<option value="">Select Staff</option>');
          data.forEach((item) =>
            staffSelect.append(
              `<option value="${item.id}">${item.username}</option>`
            )
          );
        },
      });
    });
  });
</script>
{% endblock %}