{% extends 'index.html' %} {% load static %} {% block title %} Home {% endblock %} {% block start %}
<style>
  col-12 {
    min-height: 10rem;
  }
  .modal {
    font-family: 'Poppins', sans-serif;
  }
</style>

<link rel="stylesheet" href="{% static 'styles/common.css' %}" />

<div class="container d-flex flex-column align-items-center pt-3">
  <!--Tracking-->
  <div class="row mb-4" style="font-family: 'Poppins', sans-serif;">
    <div class="col-12 d-flex align-items-center justify-content-center">
      <p class="mb-0 text-light">Track your complaint/task here</p>
      &nbsp;
      <button type="button" class="btn btn-sm btn-warning text-white" data-bs-toggle="modal" data-bs-target="#trackingModal">
        Track
      </button>
    </div>
  </div>
  <!------------>

  <div class="row w-100 g-3 pb-3">
    <!--Task-->
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 col-xl-3">
      <div
        class="shadow-sm d-flex align-items-center justify-content-center rounded text-white glass-card h-100"
      >
        {% if request.user.role == 'Admin' %}
        <a
          href="{% url 'tms:admin_dashboard' %}"
          class="text-white text-decoration-none w-100 h-100 d-flex align-items-center justify-content-center"
        >
          <div class="d-flex flex-column align-items-center">
            <div class="card-image mb-2">
              <img class="img-fluid" src="../../static/images/task-icon.png" />
            </div>
            <div class="card-title">
              <p class="fw-bold mb-0 text-center">Task Management System</p>
            </div>
          </div>
        </a>
        {% else %}
        <a
          href="{% url 'tms:staff_dashboard' %}"
          class="text-white text-decoration-none w-100 h-100 d-flex align-items-center justify-content-center"
        >
          <div class="d-flex flex-column align-items-center">
            <div class="card-image mb-2">
              <img class="img-fluid" src="../../static/images/task-icon.png" />
            </div>
            <div class="card-title">
              <p class="fw-bold mb-0 text-center">Task Management System</p>
            </div>
          </div>
        </a>
        {% endif %}
      </div>
    </div>
    <!--Complaint-->
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 col-xl-3">
      <div
        class="shadow-sm d-flex align-items-center justify-content-center rounded text-white glass-card h-100"
      >
        {% if request.user.role == 'Admin' %}
        <a
          href="{% url 'cms:admin_dashboard' %}"
          class="text-white text-decoration-none w-100 h-100 d-flex align-items-center justify-content-center"
        >
          <div class="d-flex flex-column align-items-center">
            <div class="card-image mb-2">
              <img
                class="img-fluid"
                src="../../static/images/complaint-icon.png"
              />
            </div>
            <div class="card-title">
              <p class="fw-bold mb-0 text-center">
                Complaint Management System
              </p>
            </div>
          </div>
        </a>
        {% else %}
        <a
          href="{% url 'cms:staff_dashboard' %}"
          class="text-white text-decoration-none w-100 h-100 d-flex align-items-center justify-content-center"
        >
          <div class="d-flex flex-column align-items-center">
            <div class="card-image mb-2">
              <img
                class="img-fluid"
                src="../../static/images/complaint-icon.png"
              />
            </div>
            <div class="card-title">
              <p class="fw-bold mb-0 text-center">
                Complaint Management System
              </p>
            </div>
          </div>
        </a>
        {% endif %}
      </div>
    </div>
    <!--Service-->
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 col-xl-3">
      <div
        class="shadow-sm d-flex align-items-center justify-content-center rounded text-white glass-card h-100"
      >
        {% if request.user.role == 'Admin' %}
        <a
          href="{% url 'srm:admin_dashboard' %}"
          class="text-white text-decoration-none w-100 h-100 d-flex align-items-center justify-content-center"
        >
          <div class="d-flex flex-column align-items-center">
            <div class="card-image mb-2">
              <img
                class="img-fluid"
                src="../../static/images/service-icon.png"
              />
            </div>
            <div class="card-title">
              <p class="fw-bold mb-0 text-center">
                Service Request Management
              </p>
            </div>
          </div>
        </a>
        {% else %}
        <a
          href="{% url 'srm:staff_dashboard' %}"
          class="text-white text-decoration-none w-100 h-100 d-flex align-items-center justify-content-center"
        >
          <div class="d-flex flex-column align-items-center">
            <div class="card-image mb-2">
              <img
                class="img-fluid"
                src="../../static/images/service-icon.png"
              />
            </div>
            <div class="card-title">
              <p class="fw-bold mb-0 text-center">
                Service Request Management
              </p>
            </div>
          </div>
        </a>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="trackingModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content bg-light text-primary">
      <div class="modal-header">
        <h5 class="modal-title">Track Complaint/Task here</h5>
        <button type="button" class="btn-close btn-close-danger" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="universal-track-form">
          <input class="form-control mb-2" type="text" name="q" placeholder="#enter complaint/task number" required>
          <button class="btn btn-primary" type="submit">Search</button>
        </form>
        <div id="universal-track-result" class="mt-3"></div>
      </div>
    </div>
  </div>
</div>

<script>
  document.getElementById('universal-track-form').addEventListener('submit', function (e) {
    e.preventDefault();
    const q = this.q.value.trim();
    const resultDiv = document.getElementById('universal-track-result');
    resultDiv.innerHTML = "Searching...";

    fetch(`/track/?q=${encodeURIComponent(q)}`)
      .then(res => res.json())
      .then(data => {
        if (data.found) {
          resultDiv.innerHTML = `
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>Complaint</th>
                    <th>Assigned To</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>${data.type}</td>
                    <td>${data.assigned_to}</td>
                    <td>${data.status}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          `;
        } else {
          resultDiv.innerHTML = `<div class="text-warning">${data.error}</div>`;
        }
      })
      .catch(() => {
        resultDiv.innerHTML = `<div class="text-danger">An error occurred. Try again.</div>`;
      });
  });
</script>

{% endblock %}
